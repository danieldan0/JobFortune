<!DOCTYPE html>
<html lang="uk">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Створити вакансію - JobFortune</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div id="header"></div>
    <section class="py-5">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-lg-8">
                    <div class="card shadow">
                        <div class="card-header bg-primary text-white">
                            <h4 class="mb-0">Створити вакансію</h4>
                        </div>
                        <div class="card-body p-4">
                            <div id="jobAlert" class="alert d-none" role="alert"></div>
                            <form id="createJobForm">
                                <div class="mb-3">
                                    <label for="title" class="form-label">Назва посади <span
                                            class="text-danger">*</span></label>
                                    <input type="text" class="form-control" id="title" required maxlength="255"
                                        placeholder="Senior Backend Developer">
                                </div>
                                <div class="mb-3">
                                    <label for="description" class="form-label">Опис вакансії <span
                                            class="text-danger">*</span></label>
                                    <textarea class="form-control" id="description" rows="6" required
                                        placeholder="Детальний опис роботи..."></textarea>
                                </div>
                                <div class="mb-3">
                                    <label for="requirements" class="form-label">Вимоги</label>
                                    <textarea class="form-control" id="requirements" rows="4"
                                        placeholder="Необхідні навички..."></textarea>
                                </div>
                                <div class="row">
                                    <div class="col-md-4 mb-3">
                                        <label for="salaryMin" class="form-label">Зарплата від</label>
                                        <input type="number" class="form-control" id="salaryMin" min="0"
                                            placeholder="30000">
                                    </div>
                                    <div class="col-md-4 mb-3">
                                        <label for="salaryMax" class="form-label">Зарплата до</label>
                                        <input type="number" class="form-control" id="salaryMax" min="0"
                                            placeholder="50000">
                                    </div>
                                    <div class="col-md-4 mb-3">
                                        <label for="salaryCurrency" class="form-label">Валюта</label>
                                        <select class="form-select" id="salaryCurrency">
                                            <option value="UAH">UAH</option>
                                            <option value="USD">USD</option>
                                            <option value="EUR">EUR</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label for="location" class="form-label">Місце роботи <span
                                            class="text-danger">*</span></label>
                                    <input type="text" class="form-control" id="location" required placeholder="Київ">
                                </div>
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="employmentType" class="form-label">Тип зайнятості <span
                                                class="text-danger">*</span></label>
                                        <select class="form-select" id="employmentType" required>
                                            <option value="full-time">Повна зайнятість</option>
                                            <option value="part-time">Часткова зайнятість</option>
                                            <option value="contract">Контракт</option>
                                            <option value="internship">Стажування</option>
                                        </select>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="workMode" class="form-label">Формат роботи <span
                                                class="text-danger">*</span></label>
                                        <select class="form-select" id="workMode" required>
                                            <option value="remote">Віддалено</option>
                                            <option value="on-site">В офісі</option>
                                            <option value="hybrid">Гібрид</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="d-grid gap-2">
                                    <button type="submit" class="btn btn-primary btn-lg" id="createJobBtn">
                                        <span id="createJobBtnText"><i class="bi bi-plus-circle"></i> Опублікувати
                                            вакансію</span>
                                        <span id="createJobBtnSpinner" class="spinner-border spinner-border-sm d-none"
                                            role="status"></span>
                                    </button>
                                    <a href="profile.html" class="btn btn-outline-secondary"><i
                                            class="bi bi-arrow-left"></i> Скасувати</a>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="navigation.js"></script>
    <script>
        fetch('header.html').then(r => r.text()).then(html => document.getElementById('header').innerHTML = html);
        const token = localStorage.getItem('token');
        if (!token) { window.location.href = 'login.html'; }
        document.getElementById('createJobForm').addEventListener('submit', async function (e) {
            e.preventDefault();
            const btn = document.getElementById('createJobBtn');
            const btnText = document.getElementById('createJobBtnText');
            const btnSpinner = document.getElementById('createJobBtnSpinner');
            const alert = document.getElementById('jobAlert');
            btn.disabled = true;
            btnText.classList.add('d-none');
            btnSpinner.classList.remove('d-none');
            alert.classList.add('d-none');
            const data = {
                title: document.getElementById('title').value,
                description: document.getElementById('description').value,
                requirements: document.getElementById('requirements').value,
                salaryMin: parseInt(document.getElementById('salaryMin').value) || null,
                salaryMax: parseInt(document.getElementById('salaryMax').value) || null,
                salaryCurrency: document.getElementById('salaryCurrency').value,
                location: document.getElementById('location').value,
                employmentType: document.getElementById('employmentType').value,
                workMode: document.getElementById('workMode').value,
                isActive: true
            };
            try {
                const response = await fetch('/api/v1/jobs', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'Authorization': 'Bearer ' + token },
                    body: JSON.stringify(data)
                });
                if (response.ok) {
                    alert.className = 'alert alert-success';
                    alert.textContent = 'Вакансія успішно створена!';
                    alert.classList.remove('d-none');
                    setTimeout(() => { window.location.href = 'profile.html'; }, 2000);
                } else {
                    const errorText = await response.text();
                    let errorMessage = 'Помилка створення вакансії';
                    try {
                        const error = JSON.parse(errorText);
                        if (error.message === 'Employer profile not found. Please create your employer profile first.') {
                            errorMessage = 'Спочатку створіть профіль роботодавця!';
                        } else {
                            errorMessage = error.message || errorMessage;
                        }
                    } catch { errorMessage = errorText || errorMessage; }
                    alert.className = 'alert alert-danger';
                    alert.textContent = errorMessage;
                    alert.classList.remove('d-none');
                    btn.disabled = false;
                    btnText.classList.remove('d-none');
                    btnSpinner.classList.add('d-none');
                }
            } catch (error) {
                alert.className = 'alert alert-danger';
                alert.textContent = 'Помилка з\'єднання: ' + error.message;
                alert.classList.remove('d-none');
                btn.disabled = false;
                btnText.classList.remove('d-none');
                btnSpinner.classList.add('d-none');
            }
        });
    </script>
</body>

</html>